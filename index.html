<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- Метатеги для адаптивного дизайна и кодировки -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Научпоп-журнал</title>
    <!-- Подключение Tailwind CSS через CDN для современного дизайна -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Подключение шрифта Inter от Google Fonts для чистого и современного внешнего вида -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Общие стили для всего документа, использующие шрифт Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
        }
        /* Стили для скроллбара, чтобы он соответствовал тёмной теме */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2c2c44;
        }
        ::-webkit-scrollbar-thumb {
            background: #5b5b7c;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #7a7ac2;
        }
    </style>
</head>
<body class="antialiased leading-relaxed text-gray-200">

    <!-- Главный контейнер сайта -->
    <div class="min-h-screen flex flex-col items-center p-4 md:p-8">

        <!-- Секция заголовка -->
        <header class="w-full max-w-4xl text-center py-8 mb-8">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-white leading-tight mb-2 tracking-wide">
                <span class="bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 text-transparent bg-clip-text">Мир Науки</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-400">Путешествие по тайнам Вселенной</p>
            <nav class="mt-4 flex justify-center space-x-4">
                <a href="about.html" class="inline-block bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-lg hover:from-purple-700 hover:to-indigo-700 transition duration-300 ease-in-out">
                    О нас
                </a>
                <!-- Ссылка на новую страницу админ-панели -->
                <a href="admin.html" class="inline-block bg-gradient-to-r from-gray-600 to-gray-800 text-white font-semibold py-2 px-4 rounded-lg shadow-lg hover:from-gray-700 hover:to-gray-900 transition duration-300 ease-in-out">
                    Админ-панель
                </a>
            </nav>
        </header>

        <!-- Контейнер для карточек с контентом -->
        <main id="articles-container" class="w-full max-w-6xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Здесь будут сгенерированы карточки статей -->
            <div id="loading-message" class="col-span-1 md:col-span-2 lg:col-span-3 text-center text-lg text-gray-400">
                Загрузка статей...
            </div>
        </main>

        <!-- Футер сайта -->
        <footer class="w-full max-w-4xl text-center py-8 mt-16 text-gray-500">
            <p>&copy; 2024. Все права защищены. Создано с любовью к науке. Артём Вадимович.</p>
        </footer>

    </div>

    <!-- Подключение нового скрипта, который будет генерировать статьи -->
    <script type="module" src="articles.js"></script>
    <script type="module">
        // Импорт необходимых модулей Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // *** ВНИМАНИЕ: Вот ваша конфигурация Firebase ***
        const firebaseConfig = {
            apiKey: "AIzaSyC74r3_QglvEA2UyGoBHo8U9tBL3G7MPo4",
            authDomain: "mirproject-b9723.firebaseapp.com",
            projectId: "mirproject-b9723",
            storageBucket: "mirproject-b9723.firebasestorage.app",
            messagingSenderId: "453058418449",
            appId: "1:453058418449:web:69f5632a5ab9df77781eb0",
            measurementId: "G-RV7BH5Y02S"
        };
        
        // Глобальные переменные, предоставленные средой Canvas
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        let db;
        let auth;

        const articlesContainer = document.getElementById('articles-container');
        const loadingMessage = document.getElementById('loading-message');

        async function initFirebase() {
            // Добавлена проверка на наличие API-ключа перед инициализацией
            if (!firebaseConfig.apiKey) {
                loadingMessage.textContent = 'Ошибка: Конфигурация Firebase не найдена.';
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Аутентификация пользователя
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log("User is authenticated:", user.uid);
                        fetchArticles();
                    } else {
                        console.log("No user is authenticated.");
                        loadingMessage.textContent = 'Ошибка: не удалось подключиться к базе данных. Пожалуйста, проверьте конфигурацию.';
                    }
                });

            } catch (e) {
                console.error("Error during Firebase initialization or sign-in: ", e);
                loadingMessage.textContent = `Ошибка инициализации: ${e.message}`;
            }
        }

        function createCard(article) {
            const card = document.createElement('div');
            card.className = 'bg-[#2c2c44] rounded-xl shadow-2xl overflow-hidden transform hover:scale-105 transition-transform duration-300 ease-in-out';
            card.innerHTML = `
                <img src="${article.image}" alt="${article.title}" class="w-full h-48 object-cover">
                <div class="p-6">
                    <h3 class="text-xl md:text-2xl font-bold text-white mb-2 leading-snug">${article.title}</h3>
                    <p class="text-sm text-gray-400 leading-relaxed">${article.shortText}</p>
                    <a href="#" class="mt-4 inline-block text-sm font-semibold text-purple-400 hover:text-purple-600 transition-colors">
                        Подробнее &rarr;
                    </a>
                </div>
            `;
            return card;
        }
        
        function fetchArticles() {
            const articlesCollectionPath = `/artifacts/${appId}/public/data/articles`;
            const articlesQuery = query(collection(db, articlesCollectionPath));

            onSnapshot(articlesQuery, (querySnapshot) => {
                articlesContainer.innerHTML = '';
                if (querySnapshot.empty) {
                    loadingMessage.textContent = 'Пока нет добавленных статей.';
                    articlesContainer.appendChild(loadingMessage);
                } else {
                    loadingMessage.remove();
                    querySnapshot.forEach((doc) => {
                        const article = doc.data();
                        articlesContainer.appendChild(createCard(article));
                    });
                }
            }, (error) => {
                console.error("Error fetching documents: ", error);
                loadingMessage.textContent = `Ошибка при загрузке статей: ${error.message}`;
                articlesContainer.appendChild(loadingMessage);
            });
        }
        
        document.addEventListener('DOMContentLoaded', initFirebase);
    </script>
</body>
</html>
